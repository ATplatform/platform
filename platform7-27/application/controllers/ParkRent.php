<?phpdefined('BASEPATH') OR exit('No direct script access allowed');class ParkRent extends CI_Controller{    public function __construct()    {        parent::__construct();        session_start();        //打开重定向        $this->load->helper('url');        $this->load->database();        $this->user_per_page = $this->config->item('user_per_page');        $this->at_url=$this->config->item('at_url');    }    public function index()    {        if (!isset($_SESSION['username'])) {            redirect('Login');        }        redirect('ParkRent/Parkrent');    }    /////////////////////////////////////////////////////////////////////////////////////////////////    ////////////////////////////////////////activityList/////////////////////////////////////////////    /////////////////////////////////////////////////////////////////////////////////////////////////    /////////////数据展示///////////////    public function Parkrent()    {        if (!isset($_SESSION['username'])) {            redirect('Login');        }        $this->load->model('Parkrent_model');        $this->load->model('Building_model');        $village_id = $_SESSION['village_id'];        $username=$_SESSION['username'];        $treeNav_data = $this->Building_model->getBuildingTreeData($village_id);        $building_code = $this->input->get('building_code');        $parent_code = $this->input->get('parent_code');        $rent_end_date=$this->input->get('rent_end_date');        $parklot_parkcode = $this->input->get('parklot_parkcode');        $keyword = $this->input->get('keyword');        $page = $this->input->get('page');        $page = $page ? $page : '1';        $data['nav'] = 'Parkrent';        $data['username'] = $username;        $data['at_url']= $this->at_url;        $data['treeNav_data'] = $treeNav_data;        $arrayres = $this->Parkrent_model->sqlTogetList($rent_end_date,$parklot_parkcode,$keyword, $page, $this->user_per_page);        $total = $this->Parkrent_model->getTotal($arrayres['0'],$this->user_per_page);        $data['total'] = $total;        $data['page'] = $page >= $total ? $total : $page;        $data['pagesize'] = $this->user_per_page;        $this->load->view('app/park_rent', $data);    }    //////////////////////查询数据///////////////    public function getList()    {        $rent_end_date=$this->input->get('rent_end_date');        $parklot_parkcode = $this->input->get('parklot_parkcode');        $building_code = $this->input->get('building_code');        $parent_code = $this->input->get('parent_code');        $keyword = $this->input->get('keyword');        $page = $this->input->get('page');        $page = $page ? $page : '1';        $this->load->model('Parkrent_model');        $arrayres = $this->Parkrent_model->sqlTogetList($rent_end_date,$parklot_parkcode, $keyword, $page, $this->user_per_page);        $data = $this->Parkrent_model->getList($arrayres['1']);        echo $data;    }    public function update(){        $village_id = $_SESSION['village_id'];        $rent_id = $this->input->post('rent_id');        $rent_begin_date = $this->input->post('rent_begin_date');        $rent_end_date = $this->input->post('rent_end_date');        $rent_pay_type = $this->input->post('rent_pay_type');        $rent_rent = $this->input->post('rent_rent');        $rent_renter = $this->input->post('rent_renter');        $rent_parking_lot_code = $this->input->post('rent_parking_lot_code');        $create_time = date('Y-m-d h:i:s', time());        $this->load->model('Parkrent_model');        $this->Parkrent_model->update($village_id,$rent_id,$rent_begin_date,$rent_end_date,$rent_pay_type,$rent_rent, $rent_renter,$rent_parking_lot_code,$create_time);    }    public function insert(){        $village_id = $_SESSION['village_id'];            $rent_id = $this->input->post('rent_id');$rent_begin_date = $this->input->post('rent_begin_date');    $rent_end_date = $this->input->post('rent_end_date');$rent_pay_type = $this->input->post('rent_pay_type');$rent_rent = $this->input->post('rent_rent');$rent_renter = $this->input->post('rent_renter');$rent_parking_lot_code = $this->input->post('rent_parking_lot_code');            $create_time = date('Y-m-d h:i:s', time());            $this->load->model('Parkrent_model');        $this->Parkrent_model->insert($village_id,$rent_id,$rent_begin_date,$rent_end_date,$rent_pay_type,$rent_rent, $rent_renter,$rent_parking_lot_code,$create_time);    }    public function getparking_lot_code(){        $this->load->model('Parkrent_model');        $floor=$this->input->post('floor');        $parkcode=$this->input->post('parkcode');        $res = $this->Parkrent_model->getparking_lot_code($floor,$parkcode);        print_r(json_encode($res));    }    public function getfloor(){        $this->load->model('Parkrent_model');        $res = $this->Parkrent_model->getfloor();        print_r(json_encode($res));    }    public function getLatestCode()    {        $this->load->model('Parkrent_model');        $res = $this->Parkrent_model->getLatestCode();        echo $res;    }    public function getLatestCodeforauz()    {        $this->load->model('Vehicle_model');        $res = $this->Vehicle_model->getLatestCodeforauz();        echo $res;    }    public function getpresentCodeforauz()    {        $code=$this->input->post('code');        $this->load->model('Vehicle_model');        $res = $this->Vehicle_model->getpresentCodeforauz($code);        print_r(json_encode($res));    } public function getservice_code(){     $this->load->model('Activity_model');     $res = $this->Activity_model->getservice_code();     print_r(json_encode($res)); }public function getperson_code(){    $this->load->model('Parkrent_model');    $res = $this->Parkrent_model->getperson_code();    print_r(json_encode($res));}    public function getactivity_codeUrl(){        $this->load->model('Activity_model');        $res = $this->Activity_model->getactivity_codeUrl();        print_r(json_encode($res));    }    public function getparkingcode()    {        $this->load->model('Vehicle_model');        $res = $this->Vehicle_model->getparkingcode();        print_r(json_encode($res));    }}